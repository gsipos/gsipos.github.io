---
import Layout from '../../layouts/Layout.astro'
import { Briefcase, Calendar, Building2, Link as LinkIcon } from '@lucide/astro'
import { getCollection } from 'astro:content'
import LinkPreviewImage from '@/components/LinkPreviewImage.astro'

// Get all work projects sorted by start date in descending order (newest first)
const projects = await getCollection('workProjects')
const sortedProjects = [...projects].sort((a, b) => new Date(b.data.start).getTime() - new Date(a.data.start).getTime())

// Format date function
function formatDate(date: Date): string {
  return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short' })
}

// Calculate duration between dates
function calculateDuration(start: Date, end?: Date): string {
  const endDate = end || new Date()
  const diffTime = Math.abs(endDate.getTime() - start.getTime())
  const diffMonths = Math.ceil(diffTime / (1000 * 60 * 60 * 24 * 30.44))
  
  const years = Math.floor(diffMonths / 12)
  const months = diffMonths % 12
  
  if (years > 0 && months > 0) {
    return `${years} ${years === 1 ? 'year' : 'years'}, ${months} ${months === 1 ? 'month' : 'months'}`
  } else if (years > 0) {
    return `${years} ${years === 1 ? 'year' : 'years'}`
  } else {
    return `${months} ${months === 1 ? 'month' : 'months'}`
  }
}
---

<Layout title="Work Projects | Gergely Sipos">  <div class="container mx-auto px-4 py-8 max-w-7xl">
    <div class="mb-12 max-w-3xl mx-auto text-center">
      <div
        class="inline-flex items-center gap-2 px-4 py-1.5 bg-primary/10 text-primary rounded-full text-sm font-medium mb-4"
      >
        <Briefcase size={16} />
        <span>Professional Timeline</span>
      </div>

      <h1 class="text-4xl md:text-5xl font-bold mb-4 text-foreground text-pretty">Professional Projects</h1>
      <p class="text-lg text-muted-foreground text-balance">
        A collection of professional projects I've worked on throughout my career, from the most recent to earlier ones.
      </p>
    </div>    <div class="max-w-4xl mx-auto space-y-12 mt-8">
      {
        sortedProjects.map((project, index) => (
          <div class="group relative pl-8 hover:shadow-md transition-all duration-300 p-6 rounded-lg border border-border/50 hover:border-primary/30">
            {/* Timeline elements */}
            <div class="absolute left-0 top-0 bottom-0 w-[2px] bg-gradient-to-b from-primary/80 to-primary/20"></div>
            <div class="absolute w-5 h-5 bg-background border-2 border-primary rounded-full -left-[10px] top-7 shadow-md"></div>              <div class="mb-4 flex items-center justify-between">
              <h2 class="text-2xl font-bold text-foreground group-hover:text-primary transition-colors duration-300">{project.data.title}</h2>
              {project.data.projectLink && (
                <a 
                  href={project.data.projectLink} 
                  target="_blank" 
                  rel="noopener noreferrer"
                  class="flex items-center gap-1 text-muted-foreground hover:text-primary transition-colors duration-200 bg-muted/30 hover:bg-primary/10 p-1.5 rounded-full"
                  title="View project"
                >
                  <LinkIcon size={16} />
                </a>
              )}
            </div>              <div class="flex items-center gap-2 text-sm font-medium text-primary/80 mb-4">
              <Calendar size={16} stroke-width={2} />
              <span class="bg-primary/10 px-3 py-1 rounded-full">
                {formatDate(project.data.start)} - {project.data.end ? formatDate(project.data.end) : 'Present'}
                <span class="text-muted-foreground ml-2 font-normal">
                  ({calculateDuration(project.data.start, project.data.end)})
                </span>
              </span>
            </div>{(project.data.customerName || project.data.employer) && (
              <div class="flex items-center gap-2 text-sm text-muted-foreground mb-4 border-t border-border/30 pt-3 mt-3">
                <Building2 size={16} stroke-width={2} />
                <span>
                  {project.data.customerName && (
                    <>
                      Customer: {project.data.customerLink ? (
                        <a 
                          href={project.data.customerLink} 
                          target="_blank" 
                          rel="noopener noreferrer"
                          class="text-primary/80 hover:text-primary hover:underline transition-colors duration-200"
                        >
                          {project.data.customerName}
                        </a>
                      ) : (
                        project.data.customerName
                      )}
                    </>
                  )}
                  {project.data.customerName && project.data.employer && ' | '}
                  {project.data.employer && <>Employer: <span class="text-foreground/80">{project.data.employer}</span></>}
                </span>
              </div>
            )}            {/* Project or Customer Link Preview Image */}
            {(project.data.projectLink || project.data.customerLink) && (
              <div class="mt-5 mb-6 overflow-hidden rounded-lg border border-border/50 transition-all duration-300 group-hover:border-primary/30 shadow-sm group-hover:shadow-md">
                {project.data.projectLink ? (
                  <a 
                    href={project.data.projectLink}
                    target="_blank" 
                    rel="noopener noreferrer"
                    class="block relative group/preview"
                  >
                    <LinkPreviewImage 
                      url={project.data.projectLink} 
                      class="aspect-video object-cover w-full"
                    />
                    <div class="absolute inset-0 bg-primary/0 group-hover/preview:bg-primary/10 flex items-center justify-center opacity-0 group-hover/preview:opacity-100 transition-all duration-300">
                      <span class="bg-background/80 text-primary p-2 rounded-full">
                        <LinkIcon size={24} />
                      </span>
                    </div>
                    <div class="text-xs text-muted-foreground px-3 py-1 bg-muted/30 text-right">
                      Project preview
                    </div>
                  </a>
                ) : project.data.customerLink ? (
                  <a 
                    href={project.data.customerLink}
                    target="_blank" 
                    rel="noopener noreferrer"
                    class="block relative group/preview"
                  >
                    <LinkPreviewImage 
                      url={project.data.customerLink} 
                      class="aspect-video object-cover w-full"
                    />
                    <div class="absolute inset-0 bg-primary/0 group-hover/preview:bg-primary/10 flex items-center justify-center opacity-0 group-hover/preview:opacity-100 transition-all duration-300">
                      <span class="bg-background/80 text-primary p-2 rounded-full">
                        <LinkIcon size={24} />
                      </span>
                    </div>
                    <div class="text-xs text-muted-foreground px-3 py-1 bg-muted/30 text-right">
                      Customer website preview
                    </div>
                  </a>
                ) : null}
              </div>
            )}
            
            <div class="prose prose-sm dark:prose-invert mt-4">
              <p>{project.body}</p>
            </div>
          </div>
        ))
      }
    </div>
  </div>
</Layout>
